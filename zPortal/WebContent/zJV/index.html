<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>cytoscape</title>
<link rel="icon" type="image/png" href="img/favicon.png" />
<link rel="stylesheet" href="css/common.css">
<link rel="stylesheet" href="css/app.css">
<link rel="stylesheet" href="css/1.11.3/jquery-ui.css" />
<link rel="stylesheet" href="css/minicolors/jquery.miniColors.css">
<link href="css/contextMenu/contextMenu.css" rel="stylesheet" type="text/css" />
<link href="css/bootstrap_3.3.6/bootstrap.min.css" rel="stylesheet">
<link href="css/font-awesome-4.0.3/css/font-awesome.css" rel="stylesheet" type="text/css" />

<script src="js/libs/jquery-2.1.4.min.js" type="text/javascript" ></script>
<script src="js/libs/cytoscape.min.js" type="text/javascript" ></script>
<script src="js/libs/bootstrap_3.3.6/bootstrap.min.js" type="text/javascript" ></script>
<script src="js/libs/cytoscape-cxtmenu.js" type="text/javascript" ></script>


<script src="js/libs/1.11.3/jquery-ui.min.js"></script>
<script src="//api.filepicker.io/v0/filepicker.js"></script>
	
<script src="js/libs/dragscrollable.js"></script>
<script src="js/libs/jquery.hotkeys.js"></script>
<script src="js/libs/jquery.mousewheel.js"></script>
<script src="js/libs/jquery.minicolors.js"></script>
<script src="js/libs/jquery.tmpl.js"></script>
<script src="js/libs/swfobject.js"></script>
<script src="js/libs/downloadify.min.js"></script>
<script src="js/libs/events.js"></script>
<script src="js/MindMaps.js"></script>
<script src="js/Command.js"></script>
<script src="js/CommandRegistry.js"></script>
<script src="js/Action.js"></script>
<script src="js/Util.js"></script>
<script src="js/Point.js"></script>
<script src="js/Document.js"></script>
<script src="js/MindMap.js"></script>
<script src="js/Node.js"></script>
<script src="js/NodeMap.js"></script>
<script src="js/UndoManager.js"></script>
<script src="js/UndoController.js"></script>
<script src="js/ClipboardController.js"></script>
<script src="js/ZoomController.js"></script>
<script src="js/ShortcutController.js"></script>
<script src="js/HelpController.js"></script>
<script src="js/FloatPanel.js"></script>
<script src="js/Navigator.js"></script>
<script src="js/Inspector.js"></script>
<script src="js/ToolBar.js"></script>
<script src="js/StatusBar.js"></script>
<script src="js/CanvasDrawingTools.js"></script>
<script src="js/CanvasView.js"></script>
<script src="js/CanvasPresenter.js"></script>
<script src="js/ApplicationController.js"></script>
<script src="js/MindMapModel.js"></script>
<script src="js/NewDocument.js"></script>
<script src="js/OpenDocument.js"></script>
<script src="js/SaveDocument.js"></script>
<script src="js/MainViewController.js"></script>
<script src="js/Storage.js"></script>
<script src="js/Event.js"></script>
<script src="js/Notification.js"></script>
<script src="js/StaticCanvas.js"></script>
<script src="js/PrintController.js"></script>
<script src="js/ExportMap.js"></script>
<script src="js/AutoSaveController.js"></script>
<script src="js/FilePicker.js"></script>
   
<!-- page style -->
<style>

#cy {
	width: 100%;
	height: 100%;
}

.cxtmenu-disabled {
	opacity: 0.333;
}

</style>
</head>

<script id="template-float-panel" type="text/x-jquery-tmpl">
<div class="ui-widget ui-dialog ui-corner-all ui-widget-content float-panel no-select">
  <div class="ui-dialog-titlebar ui-widget-header ui-helper-clearfix">
    <span class="ui-dialog-title">${title}</span>
    <a class="ui-dialog-titlebar-close ui-corner-all" href="#" role="button">
      <span class="ui-icon"></span>
    </a>
  </div>
  <div class="ui-dialog-content ui-widget-content">
  </div>
</div>
</script>

<script id="template-notification" type="text/x-jquery-tmpl">
<div class="notification">
  {{if closeButton}}
  <a href="#" class="close-button">x</a>
  {{/if}}
  {{if title}}
  <h1 class="title">{{html title}}</h1>
  {{/if}}
  <div class="content">{{html content}}</div>
</div>
</script>

<script id="template-open-table-item" type="text/x-jquery-tmpl">
<tr>
  <td><a class="title" href="#">${title}</a></td>
  <td>${$item.format(dates.modified)}</td>
  <td><a class="delete" href="#">delete</a></td>
</tr>
</script>

<script id="template-open" type="text/x-jquery-tmpl">
<div id="open-dialog" class="file-dialog" title="Open mind map">
  <h1>데이터베이스에서 열기</h1>
  <p>데이터 베이스에 저장된 구성도를 엽니다.</p>
  <button id="button-open-db">Open</button>
  <span class="cloud-loading">Loading...</span>
  <span class="cloud-error error"></span>
  <div class="seperator"></div>
  <h1>Local Storage</h1>
  <p>This is a list of all mind maps that are saved in your browser's local storage. Click on the title of a map to open it.</p>
  <table class="localstorage-filelist">
    <thead>
      <tr>
        <th class="title">Title</th>
        <th class="modified">Last Modified</th>
        <th class="delete"></th>
      </tr>
    </thead>
    <tbody class="document-list"></tbody>
  </table>
  <div class="seperator"></div>
  <h1>From file</h1>
  <p>Choose a mind map from your computer's hard drive.</p>
  <div class="file-chooser">
    <input type="file" />
  </div>
</div>
</script>

<script id="template-save" type="text/x-jquery-tmpl">
<div id="save-dialog" class="file-dialog" title="Save mind map">
  <h1><span class="highlight">New!</span> In the Cloud: Dropbox and more</h1>
  <p>Open, save and share your mind maps online in your favorite cloud storage. Supports Google Drive, Dropbox and more! Powered by <a href="http://www.filepicker.io" target="_blank">filepicker.io</a>.</p>
  <button id="button-save-cloudstorage">Save</button>
  <span class="cloud-error error"></span>
  <div class="seperator"></div>
  <h1>Local Storage</h1>
  <p>You can save your mind map in your browser's local storage. Be aware that this is still experimental: the space is limited and there is no guarantee that the browser will keep this document forever. Useful for frequent backups in combination with cloud storage.</p>
  <button id="button-save-localstorage">Save</button>
  <input type="checkbox" class="autosave" id="checkbox-autosave-localstorage">
  <label for="checkbox-autosave-localstorage">Save automatically every minute.</label>
  <div class="seperator"></div>
  <h1>To file</h1>
  <p>Save the mind map as a file on your computer.</p>
  <div id="button-save-hdd">Save</div>
</div>
</script>

<script id="template-navigator" type="text/x-jquery-tmpl">
<div id="navigator">
  <div class="active">
    <div id="navi-content">
      <div id="navi-canvas-wrapper">
        <canvas id="navi-canvas"></canvas>
        <div id="navi-canvas-overlay"></div>
      </div>
      <div id="navi-controls">
        <span id="navi-zoom-level"></span>
        <div class="button-zoom" id="button-navi-zoom-out"></div>
        <div id="navi-slider"></div>
        <div class="button-zoom" id="button-navi-zoom-in"></div>
      </div>
    </div>
  </div>
  <div class="inactive">
  </div>
</div>
</script>


<script id="template-inspector" type="text/x-jquery-tmpl">
<div id="inspector">
  <div id="inspector-content">
    <table id="inspector-table">
      <tr>
        <td>Font size:</td>
        <td><div
            class="buttonset buttons-very-small buttons-less-padding">
            <button id="inspector-button-font-size-decrease">A-</button>
            <button id="inspector-button-font-size-increase">A+</button>
          </div></td>
      </tr>
      <tr>
        <td>Font style:</td>
        <td><div
            class="font-styles buttonset buttons-very-small buttons-less-padding">
            <input type="checkbox" id="inspector-checkbox-font-bold" /> 
            <label
            for="inspector-checkbox-font-bold" id="inspector-label-font-bold">B</label>
              
            <input type="checkbox" id="inspector-checkbox-font-italic" /> 
            <label
            for="inspector-checkbox-font-italic" id="inspector-label-font-italic">I</label> 
            
            <input
            type="checkbox" id="inspector-checkbox-font-underline" /> 
            <label
            for="inspector-checkbox-font-underline" id="inspector-label-font-underline">U</label> 
            
            <input
            type="checkbox" id="inspector-checkbox-font-linethrough" />
             <label
            for="inspector-checkbox-font-linethrough" id="inspector-label-font-linethrough">S</label>
          </div>
        </td>
      </tr>
      <tr>
        <td>Font color:</td>
        <td><input type="hidden" id="inspector-font-color-picker"
          class="colorpicker" /></td>
      </tr>
      <tr>
        <td>Branch color:</td>
        <td><input type="hidden" id="inspector-branch-color-picker"
          class="colorpicker" />
          <button id="inspector-button-branch-color-children" title="Apply branch color to all children" class="right buttons-small buttons-less-padding">Inherit</button>
        </td>
      </tr>
    </table>
  </div>
</div>
</script>

<script id="template-export-map" type="text/x-jquery-tmpl">
<div id="export-map-dialog" title="Export mind map">
  <h2 class='image-description'>To download the map right-click the
    image and select "Save Image As"</h2>
  <div id="export-preview"></div>
</div>
</script>



<body data-spy="scroll" data-target="#tutorial-menu">
	<div id="print-area">
		<p class="print-placeholder">Please use the print option from the mind map menu</p>
	</div>
	<div id="container">
		<div id="topbar">
			<div id="toolbar">
				<div id="logo" class="logo-bg">
					<span>제타소프트</span>
				</div>
				<div class="buttons">
					<span class="buttons-left"> </span> <span class="buttons-right"></span>
				</div>
			</div>
		</div>
		<div id="canvas-container">
			<div id="cy"></div>
			
		</div>
		<div id="bottombar">
			<div id="about">
				<a href="http://www.ezetta.co.kr/index.html" target="_blank">제타소프트</a>
			</div>
			<div id="statusbar">
				<div class="buttons buttons-right buttons-small buttons-less-padding"></div>
			</div>
		</div>
	</div>
	
	<script type="text/javascript">
    //var mindmaps = mindmaps || {};
    //mindmaps.DEBUG = true;
  </script>
</body>

<!-- cy outlook script -->
<script>
$(function() { // on dom ready
	
	//initial
	init();
});

function init(){
	getCytoscapeRootNode("#" , "교통안전공단", 0);
}

function getCytoscapeRootNode(rootId, rootName, depth) {
	var fullUrl = "/zPortal/visualization/cytoscape.do";

	$.ajax({
		url : fullUrl,
		type : "GET",
		data: {rootId:rootId,rootName:rootName,depth:depth},
        contentType: "application/json; charset=utf-8",
		dataType : 'json',
		beforeSend : function() {
		},
		success : function(data) {
			alert(data);
	        var cy = window.cy = cytoscape({
	            container: document.getElementById('cy'),
	
	            ready: function () {
	               
	            },
	
	            style: [
	                {
	                    selector: 'node',
	                    css: {
	                    	'content' : 'data(name)',
							'text-valign' : 'center',
							'color' : 'white',
							'text-outline-width' : 4,
							'text-outline-color' : '#999',
							'width' : 40,
							'height' : 40
	                    }
	                },
	
	                {
	                    selector: 'edge',
	                    css: {
	                        'line-color' : '#888',
	                        'target-arrow-color' : '#333',
							'source-arrow-color' : '#333',
							'target-arrow-shape': 'triangle',
	                        'width' : 2,
	                    }
	                },
	
	                // custom classes
	                {
	                    selector: '.selected-node',
	                    css: {
	                        'border-color': '#f00',
	                        'border-width': '2px'
	                    }
	                },
	                {
	                    selector: '.tool-node',
	                    css: {
	                        'font-family': 'FontAwesome',
	                        'font-size': '3em',
	                    }
	                },
	                {
	                    selector: '.node-start',
	                    css: {
	                        'content': '\uf090'
	                    }
	                },
	                {
	                    selector: '.node-end',
	                    css: {
	                        'content': '\uf011'
	                    }
	                },
	                {
	                    selector: '.node-condition',
	                    css: {
	                        'content': '\uf0e8'
	                    }
	                },
// 	                {
// 	                    selector: '.node-result',
// 	                    css: {
// 	                        'content': '\uf24a'
// 	                    }
// 	                },
	                {
	                    selector: '.node-processing',
	                    css: {
	                        'content': '\uf085'
	                    }
	                },
// 	                {
// 	                    selector: '.node-extract',
// 	                    css: {
// 	                        'content': '\uf1fb'
// 	                    }
// 	                },
// 	                {
// 	                    selector: '.node-storeDatabase',
// 	                    css: {
// 	                        'content': '\uf1c0'
// 	                    }
// 	                },
	                {
						selector : '.NodeClass1',
						style : {
							'shape' : 'roundrectangle',
							'text-valign' : 'top',
							'background-color' : '#ccc',
							'background-opacity' : 0.333,
							'color' : '#888',
							'text-outline-width' : 0,
							'font-size' : 25
						}
					},

					{
						selector : '.NodeClass2',
						style : {
							'shape' : 'roundrectangle',
							'text-valign' : 'top',
							'background-color' : '#ccc',
							'background-opacity' : 0.333,
							'color' : '#888',
							'text-outline-width' : 0,
							'font-size' : 25
						}
					},

					{
						selector : '.NodeClass3',
						style : {
							'shape' : 'roundrectangle',
							'text-valign' : 'top',
							'background-color' : '#ccc',
							'background-opacity' : 0.333,
							'color' : '#888',
							'text-outline-width' : 0,
							'font-size' : 25
						}
					},
					{
						selector : '#rootNode',
						style : {
							'background-opacity' : 0,
							'border-width' : 1,
							'border-color' : '#aaa',
							'border-opacity' : 0.5,
							'font-size' : 50,
							'padding-top' : 40,
							'padding-left' : 40,
							'padding-bottom' : 40,
							'padding-right' : 40
						}
					}
	            ],
	
	            elements : jQuery.parseJSON(data),
	        });
	
	        //#endregion
	        cy.cxtmenu({
				selector : 'node',

				commands : [ {
					content : '루트로 열기',
					select : function() {
						getCytoscapeRootNode(this.id() , this.data('name'), 0);
					}
				},{
					content : '처음으로',
					select : function() {
						init();
					}
				},
				{
					content : '열기',
					select : function() {
						
					}
				},
				{
					content : '닫기',
					select : function() {
						
					}
				}
				,
				{
					content : '닫기12',
					select : function() {
						
					}
				}
				,
				{
					content : '보고서로이동',
					select : function() {
						document.location.href("http://www.naver.com");
					}
				}]
			});

			var options = {
				name : 'cose',
				// Called on `layoutready`
				ready : function() {
				},
				// Called on `layoutstop`
				stop : function() {
				},
				// Whether to animate while running the layout
				animate : true,
				// The layout animates only after this many milliseconds
				// (prevents flashing on fast runs)
				animationThreshold : 250,
				// Number of iterations between consecutive screen positions update
				// (0 -> only updated on the end)
				refresh : 20,
				// Whether to fit the network view after when done
				fit : true,
				// Padding on fit
				padding : 30,
				// Constrain layout bounds; { x1, y1, x2, y2 } or { x1, y1, w, h }
				boundingBox : undefined,
				// Extra spacing between components in non-compound graphs
				componentSpacing : 100,
				// Node repulsion (non overlapping) multiplier
				nodeRepulsion : function(node) {
					return 400000;
				},
				// Node repulsion (overlapping) multiplier
				nodeOverlap : 10,
				// Ideal edge (non nested) length
				idealEdgeLength : function(edge) {
					return 10;
				},
				// Divisor to compute edge forces
				edgeElasticity : function(edge) {
					return 100;
				},
				// Nesting factor (multiplier) to compute ideal edge length for nested edges
				nestingFactor : 5,
				// Gravity force (constant)
				gravity : 80,
				// Maximum number of iterations to perform
				numIter : 1000,
				// Initial temperature (maximum node displacement)
				initialTemp : 200,
				// Cooling factor (how the temperature is reduced between consecutive iterations
				coolingFactor : 0.95,
				// Lower temperature threshold (below this point the layout will end)
				minTemp : 1.0,
				// Whether to use threading to speed up the layout
				useMultitasking : true
			};

			//	 				var options = {
			//	 				  name: 'breadthfirst',

			//	 				  fit: true, // whether to fit the viewport to the graph
			//	 				  directed: false, // whether the tree is directed downwards (or edges can point in any direction if false)
			//	 				  padding: 30, // padding on fit
			//	 				  circle: false, // put depths in concentric circles if true, put depths top down if false
			//	 				  spacingFactor: 1.75, // positive spacing factor, larger => more space between nodes (N.B. n/a if causes overlap)
			//	 				  boundingBox: undefined, // constrain layout bounds; { x1, y1, x2, y2 } or { x1, y1, w, h }
			//	 				  avoidOverlap: true, // prevents node overlap, may overflow boundingBox if not enough space
			//	 				  roots: undefined, // the roots of the trees
			//	 				  maximalAdjustments: 0, // how many times to try to position the nodes in a maximal way (i.e. no backtracking)
			//	 				  animate: false, // whether to transition the node positions
			//	 				  animationDuration: 500, // duration of animation in ms if enabled
			//	 				  animationEasing: undefined, // easing of animation if enabled
			//	 				  ready: undefined, // callback on layoutready
			//	 				  stop: undefined // callback on layoutstop
			//	 				};

			cy.layout(options);
		},
		error : function(request, status, error) {
			alert("code:" + request.status + "\n" + "message:" + request.responseText + "\n" + "error:" + error);
		}

	});
}

//#region node tools
function addStartToGraph(e) {
    addObject(e, addStartToGraph);
}

function addendToGraph(e) {
    addObject(e, addendToGraph);
}

function addConditionToGraph(e) {
    addObject(e, addConditionToGraph);
}

function addResultToGraph(e) {
    addObject(e, addResultToGraph);
}

function addProcessingToGraph(e) {
    addObject(e, addProcessingToGraph);
}

function addExtractToGraph(e) {
    addObject(e, addExtractToGraph);
}

function addStoreDatabaseToGraph(e) {
    addObject(e, addStoreDatabaseToGraph);
}

function addAssetToGraph(e) {
    addObject(e, addAssetToGraph);
}

function addObject(e, action) {
    if (!e.data.canPerform(e, action)) {
        return;
    }

    var toolIndexes = e.data.data.selectedTool;
    var tool = e.data.data.options.tools[toolIndexes[0]][toolIndexes[1]];

    var object = {
        group: 'nodes',
        data: {
            name: tool.options.text
        },
        position: {
            x: e.cyPosition.x,
            y: e.cyPosition.y
        }
    }

    e.cy.add(object).addClass('tool-node').addClass(tool.options.clazz);
}
//#endregion

//#region linking
var src;
function performLink(e) {
    if (!e.data.canPerform(e, performLink)) {
        return;
    }

    if (src) {
        tgt = e.cyTarget;

        e.cy.add({
            group: "edges",
            data: {
                source: src.id(),
                target: tgt.id()
            }
        });

        src.removeClass('selected-node');
        src = undefined;
    } else {
        src = e.cyTarget;
        src.addClass('selected-node');
    }
}

function getLinkName(src, tgt) {
    return src.id() + "->" + tgt.id();
}
//#endregion

//#region Remove
function performRemove(e) {
    if (!e.data.canPerform(e, performRemove)) {
        return;
    }

    cy.remove(e.cyTarget);
}
</script>

</html>
